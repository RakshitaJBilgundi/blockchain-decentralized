<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>KYC DApp with Enhanced UI</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
          crossorigin="anonymous"/>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap"
          rel="stylesheet"/>
    <style>
        /* Reset and Base Styles */
        * {
            box-sizing: border-box;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to right, #6a82fb, #fc5c7d); /* Gradient Background */
            color: #fff;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        header h1 {
            margin: 0;
            font-weight: 700;
            font-size: 1.5rem;
        }

        #authButtons button {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            margin-left: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }

        #authButtons button:hover {
            background-color: rgba(255, 255, 255, 0.4);
        }

        /* Main Container */
        #container {
            flex: 1;
            display: flex;
            height: calc(100% - 72px);
            overflow: hidden;
            display: none; /* Hidden initially */
        }

        /* Sidebar */
        #sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            border-right: 1px solid rgba(255, 255, 255, 0.3);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            overflow-y: auto;
        }

        #sidebar h2 {
            margin-top: 0;
            font-weight: 700;
            font-size: 1.25rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 0.5rem;
        }

        #sidebar label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 600;
        }

        #sidebar input {
            width: 100%;
            padding: 0.5rem;
            border-radius: 5px;
            border: none;
            font-size: 1rem;
            margin-bottom: 1rem;
            color: #333;
        }

        #sidebar button {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
        }

        #sidebar button:hover {
            background-color: #1e40af;
        }

        /* Main Content */
        #mainContent {
            flex: 1;
            padding: 1rem 2rem;
            overflow-y: auto;
        }

        /* Tabs */
        #tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        .tab-btn.active {
            background: #2563eb;
            box-shadow: 0 0 8px #2563eb;
        }

        /* Panels */
        .panel {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 1rem;
            color: white;
            display: none;
        }

        .panel.active {
            display: block;
        }

        /* Bank List */
        #bankList,
        #adminBankList,
        #eventList {
            list-style-type: none;
            padding: 0;
            max-height: 250px;
            overflow-y: auto;
            margin-top: 0.5rem;
            border-radius: 6px;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.1);
        }

        #bankList li,
        #adminBankList li,
        #eventList li {
            padding: 0.5rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.95rem;
        }

        /* Bank Panel Specific */
        #bankPanel .input-group {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        #bankPanel label {
            width: 120px;
            text-align: right;
            margin-right: 10px;
            font-weight: 500;
        }

        #bankPanel input {
            flex: 1;
            padding: 0.5rem;
            border-radius: 5px;
            border: none;
            color: #333;
            margin-right: 10px;
        }

        #bankPanel button {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }

        #bankPanel button:hover {
            background-color: #1e40af;
        }

        /* Fund Bank Section and Transfer Bank Section*/
        #fundBankSection,
        #transferBankSection {
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            padding-top: 1rem;
        }

        /* Logs */
        #logOutput {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            color: white;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.4);
            margin-top: 1rem;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            z-index: 1000;
            opacity: 0;
            animation: fadeOut 3s forwards;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .notification.error {
            background-color: #f44336;
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: translateY(-20px);
            }
            90% {
                opacity: 1;
                transform: translateY(-20px);
            }
            100% {
                opacity: 0;
                transform: translateY(0);
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            color: #333;
            font-weight: 500;
        }

        .modal-content h2 {
            margin-top: 0;
            margin-bottom: 1rem;
            color: #2563eb;
            text-align: center;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            margin-top: -10px;
            margin-bottom: 10px;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
        }

        .modal-content input {
            width: 100%;
            padding: 10px;
            margin-bottom: 1rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: none;
            color: #333;
        }

        .modal-content button {
            width: 100%;
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 12px;
            font-size: 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.3s ease;
        }

        .modal-content button:hover {
            background-color: #1e40af;
        }
    </style>
</head>
<body>
<header>
    <h1><i class="fas fa-shield-alt"></i> Decentralized KYC</h1>
    <div>
        <p id="metaStatus">Not connected</p>
        <p id="adminStatus"></p>
    </div>
    <div id="authButtons">
        <button id="loginBtn">Login</button>
        <button id="signupBtn">Sign Up</button>
    </div>
</header>

<div id="container">
    <aside id="sidebar">
        <section id="fundBankSection">
            <h2>Fund Bank</h2>
            <label for="fundBankAddress">Bank Address (Admin)</label>
            <input type="text" id="fundBankAddress" placeholder="0x..."/>
            <label for="fundAmount">Amount</label>
            <input type="number" id="fundAmount" placeholder="Amount" min="0"/>
            <button id="fundBankBtn">Fund Bank</button>
        </section>

        <section id="transferBankSection">
            <h2>Transfer Bank</h2>
            <label for="transferSenderAddress">Sender Address (Your Wallet)</label>
            <input type="text" id="transferSenderAddress" disabled/>
            <label for="transferReceiverAddress">Receiver Address</label>
            <input type="text" id="transferReceiverAddress" placeholder="0x..."/>
            <label for="transferAmount">Amount</label>
            <input type="number" id="transferAmount" placeholder="Amount" min="0"/>
            <button id="transferBankBtn">Transfer Funds</button>
        </section>
    </aside>

    <main id="mainContent">
        <div id="tabs">
            <button id="bankTabBtn" class="tab-btn active">Bank Panel</button>
            <button id="adminTabBtn" class="tab-btn" style="display:none;">Admin Panel</button>
            <button id="connectWalletBtn" class="tab-btn">Connect Wallet</button>
            <button id="adminAccessBtn" class="tab-btn">Admin Access</button>
        </div>

        <!-- Enhanced Bank Panel UI -->
        <section id="bankPanel" class="panel active">
            <div class="input-group">
                <label for="bankName">Bank Name:</label>
                <input type="text" id="bankName" placeholder="e.g., Canara"/>
            </div>
            <div class="input-group">
                <label for="bankAddress">Bank Address:</label>
                <input type="text" id="bankAddress" placeholder="0x..."/>
            </div>
            <div class="input-group">
                <label for="bankRegNo">Registration No:</label>
                <input type="number" id="bankRegNo" placeholder="e.g., 1234"/>
            </div>
            <div class="bank-actions">
                <button id="addBank">Add Bank</button>
                <button id="removeBank">Remove Bank</button>
            </div>

            <h3>Registered Banks</h3>
            <ul id="bankList"></ul>
        </section>

        <section id="adminPanel" class="panel">
            <h2>Admin Panel - Registered Banks</h2>
            <ul id="adminBankList"></ul>

            <h2>Transfer & Fund Events</h2>
            <ul id="eventList"></ul>
        </section>

        <h2>Activity Logs</h2>
        <div id="logOutput">Logs will appear here...</div>
    </main>
</div>

<!-- Login Modal -->
<div id="loginModal" class="modal">
    <div class="modal-content">
        <span class="close" id="loginClose">&times;</span>
        <h2>Login</h2>
        <input type="email" id="loginEmail" placeholder="Email"/>
        <input type="password" id="loginPassword" placeholder="Password"/>
        <button id="loginSubmit">Login</button>
    </div>
</div>

<!-- Signup Modal -->
<div id="signupModal" class="modal">
    <div class="modal-content">
        <span class="close" id="signupClose">&times;</span>
        <h2>Sign Up</h2>
        <input type="email" id="signupEmail" placeholder="Email"/>
        <input type="password" id="signupPassword" placeholder="Password"/>
        <label for="signupDob">Date of Birth</label>
        <input type="date" id="signupDob"/>
        <label for="signupAadhaar">Aadhaar Number</label>
        <input type="text" id="signupAadhaar" placeholder="XXXX-XXXX-XXXX" maxlength="14"/>
        <button id="signupSubmit">Sign Up</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.7.5/dist/web3.min.js"></script>
<script>
    let web3, contract, account, adminAddress;
    const contractAddress = "0x2DB2eC1e6eddD82Bdc98Fc40510d2998227DCeBa";
    const contractABI = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "bankAddress",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			}
		],
		"name": "BankAdded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "bankAddress",
				"type": "address"
			}
		],
		"name": "BankRemoved",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "count",
				"type": "uint256"
			}
		],
		"name": "Login",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "_bankAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_registerNumber",
				"type": "uint256"
			}
		],
		"name": "addBank",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "bankAddresses",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "bankAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "fundBank",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "getBankAddress",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_bank",
				"type": "address"
			}
		],
		"name": "getBankDetails",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getBanksCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "getKYCStatus",
		"outputs": [
			{
				"internalType": "enum DecentralizedKYC.Status",
				"name": "",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "kycProviders",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "kycRecords",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "documentHash",
				"type": "string"
			},
			{
				"internalType": "enum DecentralizedKYC.Status",
				"name": "status",
				"type": "uint8"
			},
			{
				"internalType": "address",
				"name": "verifiedBy",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "login",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "registeredBanks",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "addr",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "registerNumber",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "balance",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "loginCount",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "exists",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_bankAddress",
				"type": "address"
			}
		],
		"name": "removeBank",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_documentHash",
				"type": "string"
			}
		],
		"name": "submitKYC",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "transfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "approve",
				"type": "bool"
			}
		],
		"name": "verifyKYC",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];
    async function initWeb3() {
        if (window.ethereum) {
            web3 = new Web3(window.ethereum);
            try {
                const accounts = await window.ethereum.request({method: "eth_requestAccounts"});
                account = accounts[0];
                updateLog(`Connected with account: ${account}`);
                loadContract();
                document.getElementById("container").style.display = "flex";
                document.getElementById('transferSenderAddress').value = account;
            } catch (error) {
                updateLog(`Connection error: ${error.message}`);
                showNotification(`Connection error: ${error.message}`, 'error');
            }
        } else {
            updateLog("Please install MetaMask!");
            showNotification('Please install MetaMask!', 'error');
        }
    }

    async function loadContract() {
        contract = new web3.eth.Contract(contractABI, contractAddress);
        updateLog(`Contract loaded at: ${contractAddress}`);
        try {
            adminAddress = await contract.methods.admin().call();
            updateLog(`Admin address: ${adminAddress}`);
            updateMetaStatus();
            updateAdminStatus();
            loadBanks();

        } catch (error) {
            updateLog(`Error loading contract data: ${error.message}`);
            showNotification(`Error loading contract data: ${error.message}`, 'error');
        }
    }

    // Update status messages
    function updateMetaStatus() {
        document.getElementById("metaStatus").innerText = account
            ? `Connected: ${account.substring(0, 6)}...`
            : "Not connected";
    }

    function updateAdminStatus() {
        if (account && adminAddress) {
            const isAdmin = account.toLowerCase() === adminAddress.toLowerCase();
            document.getElementById("adminStatus").innerText = isAdmin ? "Admin" : "User";
            document.getElementById("adminTabBtn").style.display = isAdmin ? "inline-block" : "none";
        } else {
            document.getElementById("adminStatus").innerText = "";
            document.getElementById("adminTabBtn").style.display = "none";
        }
    }

    // Enable/disable main interface based on connection
    function toggleUI() {
        const isConnected = !!account;
        document.getElementById("container").style.display = isConnected ? "flex" : "none";
    }

    // Function to log messages to the output
    function updateLog(message) {
        const logOutput = document.getElementById("logOutput");
        logOutput.textContent += `\n${message}`;
        logOutput.scrollTop = logOutput.scrollHeight; // Scroll to bottom
    }

    // Clear the log
    function clearLogs() {
        document.getElementById("logOutput").textContent = "";
    }

    // Notification function
    function showNotification(message, type = "info") {
        const notification = document.createElement("div");
        notification.classList.add("notification", type);
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
            notification.remove();
        }, 3000); // Adjust time as needed
    }

    // ========================================================================
    // BANK FUNCTIONS

    async function addBank() {
        const bankName = document.getElementById("bankName").value;
        const bankAddress = document.getElementById("bankAddress").value;
        const bankRegNo = document.getElementById("bankRegNo").value;

        // Validate inputs
        if (!bankName || !bankAddress || !bankRegNo) {
            showNotification("Please fill out all bank details.", "error");
            return;
        }

        if (!web3.utils.isAddress(bankAddress)) {
            showNotification("Invalid bank address.", "error");
            return;
        }

        try {
            // Convert registration number to uint
            const regNumber = parseInt(bankRegNo, 10);
            if (isNaN(regNumber)) {
                showNotification("Invalid registration number.", "error");
                return;
            }

            // Call contract method
            await contract.methods
                .addBank(bankName, bankAddress, regNumber)
                .send({from: account, gas: 300000});

            updateLog(`Bank added: ${bankName} at ${bankAddress}`);
            showNotification("Bank added successfully!");
            loadBanks(); // Reload bank list
        } catch (error) {
            updateLog(`Error adding bank: ${error.message}`);
            showNotification(`Error adding bank: ${error.message}`, "error");
        }
    }

    async function removeBank() {
        const bankAddress = document.getElementById("bankAddress").value;

        if (!bankAddress) {
            showNotification("Please enter the bank address to remove.", "error");
            return;
        }

        if (!web3.utils.isAddress(bankAddress)) {
            showNotification("Invalid bank address.", "error");
            return;
        }

        try {
            await contract.methods.removeBank(bankAddress).send({from: account, gas: 300000});
            updateLog(`Bank removed at: ${bankAddress}`);
            showNotification("Bank removed successfully!");
            loadBanks(); // Reload bank list
        } catch (error) {
            updateLog(`Error removing bank: ${error.message}`);
            showNotification(`Error removing bank: ${error.message}`, "error");
        }
    }

    async function loadBanks() {
  const bankList = document.getElementById("bankList");
  bankList.innerHTML = ""; // Clear current list

  const adminBankList = document.getElementById("adminBankList");
  adminBankList.innerHTML = "";

  try {
    const bankCount = await contract.methods.getBanksCount().call();
    updateLog(`Total banks: ${bankCount}`);

    for (let i = 0; i < bankCount; i++) {
      const bankAddress = await contract.methods.getBankAddress(i).call();
      const bankDetails = await contract.methods.getBankDetails(bankAddress).call();

      const listItem = document.createElement("li");
      listItem.textContent = `Name: ${bankDetails[0]}, Address: ${bankDetails[1]}, Reg No: ${bankDetails[2]}`;
      bankList.appendChild(listItem);

      const adminListItem = document.createElement("li");
      adminListItem.textContent = `Name: ${bankDetails[0]}, Address: ${bankDetails[1]}, Reg No: ${bankDetails[2]}`;
      adminBankList.appendChild(adminListItem);
    }
  } catch (error) {
    updateLog(`Error loading banks: ${error.message}`);
    showNotification(`Error loading banks: ${error.message}`, "error");
  }
}


    async function fundBank() {
      const bankAddress = document.getElementById("fundBankAddress").value;
      const amount = document.getElementById("fundAmount").value;

      if (!bankAddress || !amount) {
        showNotification("Please enter bank address and amount.", "error");
        return;
      }

	   if (!web3.utils.isAddress(bankAddress)) {
            showNotification("Invalid bank address.", "error");
            return;
        }

      try {
        // Call contract method to fund bank
        await contract.methods.fundBank(bankAddress, amount).send({ from: account, gas: 300000 });

        updateLog(`Funded ${amount} to bank at ${bankAddress}`);
        showNotification(`Funded ${amount} to bank successfully!`);
      } catch (error) {
        updateLog(`Error funding bank: ${error.message}`);
        showNotification(`Error funding bank: ${error.message}`, "error");
      }
    }

    async function transferBank() {
      const receiverAddress = document.getElementById("transferReceiverAddress").value;
      const amount = document.getElementById("transferAmount").value;

      if (!receiverAddress || !amount) {
        showNotification("Please enter receiver address and amount.", "error");
        return;
      }

	   if (!web3.utils.isAddress(receiverAddress)) {
            showNotification("Invalid bank address.", "error");
            return;
        }

      try {
        await contract.methods.transfer(receiverAddress, amount).send({ from: account, gas: 300000 });
        updateLog(`Transferred ${amount} to ${receiverAddress}`);
        showNotification(`Transferred ${amount} successfully!`);
      } catch (error) {
        updateLog(`Transfer error: ${error.message}`);
        showNotification(`Transfer error: ${error.message}`, "error");
      }
    }
    // ========================================================================

    // Modal Functions
    const openModal = (modalId) => {
      document.getElementById(modalId).style.display = "block";
    };

    const closeModal = (modalId) => {
      document.getElementById(modalId).style.display = "none";
    };

    // Event Listeners
    document.getElementById("connectWalletBtn").addEventListener("click", initWeb3);
    document.getElementById("bankTabBtn").addEventListener("click", () => showPanel("bankPanel"));
    document.getElementById("adminTabBtn").addEventListener("click", () => showPanel("adminPanel"));
	document.getElementById("adminAccessBtn").addEventListener("click", () => document.getElementById("adminTabBtn").style.display = 'inline-block');
    document.getElementById("addBank").addEventListener("click", addBank);
    document.getElementById("removeBank").addEventListener("click", removeBank);
    document.getElementById("fundBankBtn").addEventListener("click", fundBank);
    document.getElementById("transferBankBtn").addEventListener("click", transferBank);

    // Modal Buttons
    document.getElementById("loginBtn").addEventListener("click", () => openModal("loginModal"));
    document.getElementById("signupBtn").addEventListener("click", () => openModal("signupModal"));
    document.getElementById("loginClose").addEventListener("click", () => closeModal("loginModal"));
    document.getElementById("signupClose").addEventListener("click", () => closeModal("signupModal"));
    window.onclick = function (event) {
      if (event.target.className === "modal") {
        closeModal(event.target.id);
      }
    };

    // Function to show panel
    function showPanel(panelId) {
      document.querySelectorAll(".panel").forEach((panel) => panel.classList.remove("active"));
      document.getElementById(panelId).classList.add("active");

      // Update active state for tab buttons
      document.querySelectorAll(".tab-btn").forEach((btn) => btn.classList.remove("active"));
      document.querySelector(`#${panelId.replace('Panel', 'TabBtn')}`).classList.add("active");
    }

    // Set initial panel
    showPanel("bankPanel");

    // Auto-connect if already authorized
    window.addEventListener("load", async () => {
      if (window.ethereum) {
        try {
          const accounts = await window.ethereum.request({ method: "eth_accounts" });
          if (accounts.length > 0) {
            account = accounts[0];
            updateLog(`Auto-connected with account: ${account}`);
            initWeb3(); // Load everything after auto-connect
            document.getElementById("container").style.display = "flex";
			document.getElementById('transferSenderAddress').value = account;
          } else {
            updateLog("No accounts found. Please connect with MetaMask.");
          }
        } catch (error) {
          updateLog(`Auto-connect error: ${error.message}`);
        }
      } else {
        updateLog("MetaMask not detected. Please install it.");
      }
    });
  </script>
</body>
</html>