<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>KYC DApp - Auto Show Bank/Admin Panel on Wallet Connect</title>
    <style>
        /* Reset & base */
        * {
            box-sizing: border-box;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            color: #2c3e50;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        a {
            color: #3498db;
            text-decoration: none;
            cursor: pointer;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Container */
        #app {
            display: flex;
            height: 100vh;
            overflow: hidden;
            background: #f0f2f5;
        }

        /* Sidebar */
        #sidebar {
            width: 260px;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            padding-top: 30px;
            flex-shrink: 0;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            transition: width 0.3s ease;
        }

        #sidebar.collapsed {
            width: 60px;
        }

        #sidebar h2 {
            margin: 0 0 30px 25px;
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 1.5px;
            user-select: none;
            white-space: nowrap;
            transition: opacity 0.3s ease;
        }

        #sidebar.collapsed h2 {
            opacity: 0;
            pointer-events: none;
        }

        #sidebar nav {
            flex: 1;
        }

        #sidebar nav a {
            display: flex;
            align-items: center;
            padding: 14px 25px;
            border-left: 4px solid transparent;
            font-weight: 600;
            font-size: 1rem;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            white-space: nowrap;
            user-select: none;
        }

        #sidebar nav a:hover,
        #sidebar nav a.active {
            background-color: #34495e;
            border-left-color: #3498db;
            color: #ecf0f1;
        }

        #sidebar nav a i {
            margin-right: 15px;
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }

        #sidebar.collapsed nav a span {
            display: none;
        }

        #sidebar nav a.logout {
            margin-top: auto;
            border-top: 1px solid #34495e;
            color: #e74c3c;
            font-weight: 700;
        }

        #sidebar nav a.logout:hover {
            background-color: #c0392b;
            border-left-color: #e74c3c;
            color: white;
        }

        /* Sidebar toggle button */
        #sidebar-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 10px 25px;
            text-align: left;
            user-select: none;
            outline: none;
            transition: background-color 0.3s ease;
        }

        #sidebar-toggle:hover {
            background-color: #34495e;
        }

        #sidebar.collapsed #sidebar-toggle {
            text-align: center;
            padding: 10px 0;
        }

        /* Main content */
        #main {
            flex: 1;
            padding: 30px 40px;
            overflow-y: auto;
            background-color: white;
            border-radius: 0 15px 15px 0;
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        /* Top bar */
        #topbar {
            height: 50px;
            background-color: #ecf0f1;
            border-radius: 12px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 0 20px;
            margin-bottom: 30px;
            font-weight: 600;
            color: #2c3e50;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.07);
        }

        #connect-wallet-btn {
            background-color: #3498db;
            border: none;
            color: white;
            padding: 8px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
            user-select: none;
        }

        #connect-wallet-btn:hover:not(:disabled) {
            background-color: #2980b9;
        }

        #connect-wallet-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        #wallet-address {
            margin-left: 20px;
            font-weight: 700;
            font-size: 1rem;
            color: #27ae60;
            user-select: text;
        }

        /* Forms */
        form {
            max-width: 600px;
            margin-top: 10px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            font-size: 0.95rem;
            color: #34495e;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        input[type="date"] {
            width: 100%;
            padding: 12px 14px;
            margin-bottom: 20px;
            border: 1.8px solid #bdc3c7;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            box-shadow: inset 1px 1px 3px rgba(0, 0, 0, 0.05);
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 8px #3498dbaa;
        }

        button[type="submit"],
        button[type="button"] {
            background-color: #3498db;
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: background-color 0.3s ease;
            user-select: none;
            margin-right: 15px;
            box-shadow: 0 4px 6px rgba(52, 152, 219, 0.4);
        }

        button[type="submit"]:hover,
        button[type="button"]:hover {
            background-color: #2980b9;
            box-shadow: 0 6px 10px rgba(41, 128, 185, 0.6);
        }

        button[type="submit"]:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Sections */
        section {
            display: none;
            flex: 1;
            overflow-y: auto;
            animation: fadeIn 0.3s ease forwards;
        }

        section.active {
            display: block;
        }

        /* Login/Signup container */
        #auth-container {
            max-width: 420px;
            margin: 100px auto;
            background-color: white;
            padding: 40px 50px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            user-select: none;
        }

        #auth-container h2 {
            margin-top: 0;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
            color: #34495e;
            font-weight: 900;
            letter-spacing: 2px;
        }

        #auth-container p {
            text-align: center;
            margin-top: 20px;
            font-size: 0.95rem;
            color: #7f8c8d;
        }

        #auth-container p a {
            font-weight: 700;
            color: #3498db;
            cursor: pointer;
        }

        #auth-container p a:hover {
            color: #2980b9;
        }

        .error {
            color: #e74c3c;
            margin-bottom: 20px;
            font-weight: 700;
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 900px) {
            #app {
                flex-direction: column;
            }

            #sidebar {
                width: 100%;
                height: 60px;
                flex-direction: row;
                padding-top: 0;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                border-radius: 0 0 15px 15px;
                overflow-x: auto;
            }

            #sidebar.collapsed {
                width: 100%;
            }

            #sidebar h2 {
                display: none;
            }

            #sidebar nav {
                display: flex;
                flex: 1;
                justify-content: space-around;
                align-items: center;
            }

            #sidebar nav a {
                flex: none;
                border-left: none;
                border-bottom: none;
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            #sidebar nav a.logout {
                border-top: none;
                color: #e74c3c;
            }

            #main {
                flex: none;
                height: calc(100vh - 60px);
                padding: 20px 15px;
                border-radius: 0;
                box-shadow: none;
            }
        }

        /* Table styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.95rem;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 12px 15px;
            vertical-align: top;
            text-align: left;
            word-break: break-word;
        }

        th {
            background-color: #3498db;
            color: white;
            font-weight: 700;
            user-select: none;
        }

        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* Logs inside table cell */
        .log-entry {
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 6px;
            white-space: pre-wrap;
            border-left: 3px solid #3498db;
            padding-left: 6px;
        }

        /* Remove button */
        .remove-btn {
            background-color: #e74c3c;
            padding: 8px 14px;
            font-size: 0.9rem;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            border: none;
            transition: background-color 0.3s ease;
            user-select: none;
            box-shadow: 0 3px 6px rgba(231, 76, 60, 0.5);
        }

        .remove-btn:hover {
            background-color: #c0392b;
            box-shadow: 0 5px 10px rgba(192, 57, 43, 0.7);
        }

        /* Your Bank Details Panel */
        #your-bank-details {
            background-color: #d6eaf8;
            border: 2px solid #3498db;
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
            max-width: 700px;
            user-select: none;
            position: relative;
        }

        #your-bank-details h3 {
            margin-top: 0;
            color: #21618c;
            font-weight: 900;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        #your-bank-details p {
            font-size: 1.05rem;
            margin: 6px 0;
            color: #154360;
        }

        #your-bank-details button {
            position: absolute;
            top: 20px;
            right: 30px;
            background-color: #e74c3c;
            padding: 8px 16px;
            font-weight: 700;
            font-size: 0.95rem;
            border-radius: 12px;
            box-shadow: 0 3px 6px rgba(231, 76, 60, 0.5);
            transition: background-color 0.3s ease;
            user-select: none;
            cursor: pointer;
            border: none;
        }

        #your-bank-details button:hover {
            background-color: #c0392b;
            box-shadow: 0 5px 10px rgba(192, 57, 43, 0.7);
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>

    <div id="auth-container" aria-label="Authentication Container">
        <h2 id="auth-title">Login</h2>
        <form id="auth-form" novalidate>
            <div id="auth-error" class="error" aria-live="polite" style="display:none;"></div>
            <label for="auth-email">Email</label>
            <input type="email" id="auth-email" name="auth-email" required placeholder="your@email.com"
                autocomplete="username" />
            <label for="auth-password">Password</label>
            <input type="password" id="auth-password" name="auth-password" required placeholder="********"
                autocomplete="current-password" />
            <div id="auth-confirm-container" style="display:none;">
                <label for="auth-confirm-password">Confirm Password</label>
                <input type="password" id="auth-confirm-password" name="auth-confirm-password" placeholder="********"
                    autocomplete="new-password" />
            </div>
            <button type="submit" id="auth-submit-btn" aria-label="Submit authentication form">Login</button>
        </form>
        <p id="auth-switch-text" aria-live="polite">Don't have an account? <a id="switch-to-signup" href="#">Sign
                Up</a></p>
    </div>

    <div id="app" style="display:none;" aria-label="Main Application">
        <aside id="sidebar" aria-label="Sidebar navigation">
            <h2>KYC DApp</h2>
            <button id="sidebar-toggle" aria-label="Toggle sidebar" title="Toggle sidebar" tabindex="0">&#9776;</button>
            <nav>
                <a href="#" data-section="fund-bank" class="active" tabindex="0" aria-current="page"><i
                        class="fas fa-money-bill-alt"></i><span>Fund Bank</span></a>
                <a href="#" data-section="transfer-bank" tabindex="0"><i
                        class="fas fa-exchange-alt"></i><span>Transfer Bank</span></a>
                <a href="#" data-section="bank-panel" tabindex="0"><i class="fas fa-university"></i><span>Bank
                        Panel</span></a>
                <a href="#" data-section="customer-panel" tabindex="0"><i class="fas fa-user"></i><span>Customer
                        Panel</span></a>
                <a href="#" data-section="admin-panel" tabindex="0"><i class="fas fa-cogs"></i><span>Admin
                        Panel</span></a>
                <a href="#" id="logout-link" class="logout" tabindex="0"><i
                        class="fas fa-sign-out-alt"></i><span>Logout</span></a>
            </nav>
        </aside>
        <main id="main" tabindex="0">
            <!-- Your Bank Details Panel -->
            <div id="your-bank-details" style="display:none;" aria-label="Your Bank Details Panel">
                <h3>Your Bank Details</h3>
                <p><strong>Name:</strong> <span id="your-bank-name"></span></p>
                <p><strong>Address:</strong> <span id="your-bank-address"></span></p>
                <p><strong>Registration No.:</strong> <span id="your-bank-regno"></span></p>
                <button id="your-bank-remove-btn" aria-label="Remove your bank">Remove Bank</button>
            </div>

            <div id="topbar" role="region" aria-label="Wallet connection status">
                <button id="connect-wallet-btn" aria-live="polite" aria-pressed="false">Connect Wallet</button>
                <span id="wallet-address" aria-live="polite" aria-atomic="true"></span>
            </div>

            <section id="fund-bank" aria-label="Fund Bank Section">
                <h2>Fund Bank</h2>
                <form id="fund-bank-form" novalidate>
                    <label for="fund-bank-address">Bank Address (Admin)</label>
                    <input type="text" id="fund-bank-address" name="fund-bank-address" placeholder="0x..." required />
                    <label for="fund-bank-amount">Amount (ETH)</label>
                    <input type="number" id="fund-bank-amount" name="fund-bank-amount" placeholder="Amount" min="0"
                        step="0.0001" required />
                    <button type="submit" aria-label="Fund bank">Fund Bank</button>
                </form>
            </section>

            <section id="transfer-bank" aria-label="Transfer Bank Section">
                <h2>Transfer Bank</h2>
                <form id="transfer-bank-form" novalidate>
                    <label for="transfer-sender-address">Sender Address (Your Wallet)</label>
                    <input type="text" id="transfer-sender-address" name="transfer-sender-address" readonly
                        aria-readonly="true" />
                    <label for="transfer-receiver-address">Receiver Address</label>
                    <input type="text" id="transfer-receiver-address" name="transfer-receiver-address"
                        placeholder="0x..." required />
                    <label for="transfer-amount">Amount (ETH)</label>
                    <input type="number" id="transfer-amount" name="transfer-amount" placeholder="Amount" min="0"
                        step="0.0001" required />
                    <button type="submit" aria-label="Transfer funds">Transfer Funds</button>
                </form>
            </section>

            <section id="bank-panel" aria-label="Bank Panel Section">
                <h2>Bank Panel</h2>
                <table id="bank-table" aria-describedby="bank-panel-desc">
                    <caption id="bank-panel-desc" style="text-align:left; font-style: italic; margin-bottom: 8px; color:#555;">
                        Shows all registered banks with logs and transaction stats.
                    </caption>
                    <thead>
                        <tr>
                            <th scope="col">Bank Name</th>
                            <th scope="col">Bank Address</th>
                            <th scope="col">Registration No.</th>
                            <th scope="col">Logs</th>
                            <th scope="col">Transaction Count</th>
                            <th scope="col">Funded (ETH)</th>
                            <th scope="col">Transferred (ETH)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic rows here -->
                    </tbody>
                </table>
                <p id="bank-panel-empty" style="margin-top: 15px; font-style: italic; color: #777;">No banks
                    registered yet.</p>
            </section>

            <section id="customer-panel" aria-label="Customer KYC Panel Section">
                <h2>Customer KYC Panel</h2>
                <form id="customer-kyc-form" novalidate>
                    <label for="customer-name">Name</label>
                    <input type="text" id="customer-name" name="customer-name" placeholder="Your Name" required />
                    <label for="document-hash">Document Hash</label>
                    <input type="text" id="document-hash" name="document-hash" placeholder="Document Hash" required />
                    <button type="submit" aria-label="Submit KYC">Submit KYC</button>
                </form>
            </section>

            <section id="admin-panel" aria-label="Admin Panel Section">
                <h2>Admin Panel</h2>
                <form id="add-bank-form" novalidate>
                    <label for="bank-name">Bank Name</label>
                    <input type="text" id="bank-name" name="bank-name" placeholder="Bank Name" required />
                    <label for="bank-address">Bank Address</label>
                    <input type="text" id="bank-address" name="bank-address" placeholder="0x..." required />
                    <label for="bank-regno">Registration No.</label>
                    <input type="number" id="bank-regno" name="bank-regno" placeholder="Registration No." required />
                    <button type="submit" aria-label="Add bank">Add Bank</button>
                </form>
            </section>
        </main>
    </div>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Include ethers.js v5 CDN BEFORE your custom script -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.min.js" type="application/javascript"></script>

    <script>
        const authContainer = document.getElementById('auth-container');
        const authForm = document.getElementById('auth-form');
        const authError = document.getElementById('auth-error');
        const authSwitchText = document.getElementById('auth-switch-text');
        const switchToSignup = document.getElementById('switch-to-signup');
        const authConfirmContainer = document.getElementById('auth-confirm-container');
        const authSubmitBtn = document.getElementById('auth-submit-btn');
        const authTitle = document.getElementById('auth-title');
        let isSignup = false;

        const app = document.getElementById('app');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('#sidebar nav a');
        const connectWalletBtn = document.getElementById('connect-wallet-btn');
        const walletAddressSpan = document.getElementById('wallet-address');
        const yourBankDetails = document.getElementById('your-bank-details');
        const yourBankNameSpan = document.getElementById('your-bank-name');
        const yourBankAddressSpan = document.getElementById('your-bank-address');
        const yourBankRegnoSpan = document.getElementById('your-bank-regno');
        const yourBankRemoveBtn = document.getElementById('your-bank-remove-btn');
        const fundBankForm = document.getElementById('fund-bank-form');
        const fundBankAddressInput = document.getElementById('fund-bank-address');
        const fundBankAmountInput = document.getElementById('fund-bank-amount');
        const transferBankForm = document.getElementById('transfer-bank-form');
        const transferSenderAddressInput = document.getElementById('transfer-sender-address');
        const transferReceiverAddressInput = document.getElementById('transfer-receiver-address');
        const transferAmountInput = document.getElementById('transfer-amount');
        const bankTable = document.getElementById('bank-table');
        const bankTableBody = bankTable.querySelector('tbody');
        const bankPanelEmpty = document.getElementById('bank-panel-empty');
        const customerKycForm = document.getElementById('customer-kyc-form');
        const customerNameInput = document.getElementById('customer-name');
        const documentHashInput = document.getElementById('document-hash');
        const addBankForm = document.getElementById('add-bank-form');
        const bankNameInput = document.getElementById('bank-name');
        const bankAddressInput = document.getElementById('bank-address');
        const bankRegnoInput = document.getElementById('bank-regno');

        let currentAccount = null;
        let contract = null; // Your smart contract instance

        // TODO: Replace with your actual deployed contract address
        const contractAddress = '0xEC917C1c5462d2538D1e5a65444c8C132b6A21b7';

        // TODO: Replace with your actual contract ABI JSON array
        const contractABI =[
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "_bankAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_registerNumber",
				"type": "uint256"
			}
		],
		"name": "addBank",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "bankAddress",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			}
		],
		"name": "BankAdded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "bankAddress",
				"type": "address"
			}
		],
		"name": "BankRemoved",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "bankAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "fundBank",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "bytes32",
				"name": "documentHash",
				"type": "bytes32"
			}
		],
		"name": "KYCRequestSubmitted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "KYCRequestUpdated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "enum DecentralizedKYC.Status",
				"name": "status",
				"type": "uint8"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "verifiedBy",
				"type": "address"
			}
		],
		"name": "KYCRequestVerified",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "KYCStatusRevoked",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "login",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "count",
				"type": "uint256"
			}
		],
		"name": "Login",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_bankAddress",
				"type": "address"
			}
		],
		"name": "removeBank",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "revokeKYC",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "bytes32",
				"name": "_documentHash",
				"type": "bytes32"
			}
		],
		"name": "submitKYC",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "transfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "bytes32",
				"name": "_documentHash",
				"type": "bytes32"
			}
		],
		"name": "updateKYC",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "approve",
				"type": "bool"
			}
		],
		"name": "verifyKYC",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "bankAddresses",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "getBankAddress",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_bank",
				"type": "address"
			}
		],
		"name": "getBankDetails",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getBanksCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "getKYCRecord",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			},
			{
				"internalType": "enum DecentralizedKYC.Status",
				"name": "",
				"type": "uint8"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "getKYCStatus",
		"outputs": [
			{
				"internalType": "enum DecentralizedKYC.Status",
				"name": "",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "kycProviders",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "kycRecords",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "bytes32",
				"name": "documentHash",
				"type": "bytes32"
			},
			{
				"internalType": "enum DecentralizedKYC.Status",
				"name": "status",
				"type": "uint8"
			},
			{
				"internalType": "address",
				"name": "verifiedBy",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "lastUpdate",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "registeredBanks",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "addr",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "registerNumber",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "balance",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "loginCount",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "exists",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

        // Function to handle authentication form submission
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const confirmPassword = isSignup ? document.getElementById('auth-confirm-password').value : null;

            if (isSignup && password !== confirmPassword) {
                authError.textContent = 'Passwords do not match.';
                authError.style.display = 'block';
                return;
            }

            // For demonstration purposes, we'll just simulate successful authentication
            authError.style.display = 'none';
            authContainer.style.display = 'none';
            app.style.display = 'flex';
        });

        // Function to toggle between login and signup forms
        switchToSignup.addEventListener('click', (e) => {
            e.preventDefault();
            isSignup = !isSignup;

            authTitle.textContent = isSignup ? 'Sign Up' : 'Login';
            authSubmitBtn.textContent = isSignup ? 'Sign Up' : 'Login';
            authSwitchText.innerHTML = isSignup
                ? 'Already have an account? <a id="switch-to-login" href="#">Login</a>'
                : "Don't have an account? <a id='switch-to-signup' href='#'>Sign Up</a>";
            authConfirmContainer.style.display = isSignup ? 'block' : 'none';
        });

        // Sidebar toggle functionality
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
        });

        // Section navigation
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = link.dataset.section;

                sections.forEach(section => section.classList.remove('active'));
                navLinks.forEach(navLink => navLink.classList.remove('active'));

                document.getElementById(sectionId).classList.add('active');
                link.classList.add('active');
            });
        });

        // Wallet connection
        connectWalletBtn.addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    currentAccount = accounts[0];
                    walletAddressSpan.textContent = currentAccount;
                    connectWalletBtn.disabled = true;
                    connectWalletBtn.textContent = 'Wallet Connected';

                    // Initialize contract with signer
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    const signer = provider.getSigner();
                    contract = new ethers.Contract(contractAddress, contractABI, signer);

                    // Set sender address in transfer form
                    transferSenderAddressInput.value = currentAccount;

                    // Call function to determine user role and show appropriate panel
                    await determineUserRole();
                } catch (error) {
                    console.error('Wallet connection error:', error);
                    walletAddressSpan.textContent = 'Connection Failed';
                }
            } else {
                walletAddressSpan.textContent = 'No Wallet Detected';
            }
        });

        // Logout
        document.getElementById('logout-link').addEventListener('click', (e) => {
            e.preventDefault();
            currentAccount = null;
            walletAddressSpan.textContent = '';
            connectWalletBtn.disabled = false;
            connectWalletBtn.textContent = 'Connect Wallet';
            app.style.display = 'none';
            authContainer.style.display = 'block';
        });

        // Function to determine user role and show appropriate panel
        async function determineUserRole() {
            if (contract) {
                try {
                    // Check if the connected wallet is the admin
                    const adminAddress = await contract.admin();
                    if (currentAccount.toLowerCase() === adminAddress.toLowerCase()) {
                        showAdminPanel();
                        return;
                    }

                    // Check if the connected wallet is a registered bank
                    const bank = await contract.getBankDetails(currentAccount);
                    if (bank.addr && bank.addr.toLowerCase() === currentAccount.toLowerCase()) {
                        showBankPanel(bank);
                        return;
                    }

                    // Otherwise, show customer panel
                    showCustomerPanel();
                } catch (error) {
                    console.error('Error determining user role:', error);
                    // Fallback to customer panel on error
                    showCustomerPanel();
                }
            }
        }

        function showAdminPanel() {
            sections.forEach(section => section.style.display = 'none');
            document.getElementById('admin-panel').style.display = 'block';
            yourBankDetails.style.display = 'none';
        }

        function showBankPanel(bankDetails) {
            sections.forEach(section => section.style.display = 'none');
            document.getElementById('bank-panel').style.display = 'block';
            yourBankDetails.style.display = 'block';
            yourBankNameSpan.textContent = bankDetails.name;
            yourBankAddressSpan.textContent = bankDetails.addr;
            yourBankRegnoSpan.textContent = bankDetails.registerNumber.toString();
        }

        function showCustomerPanel() {
            sections.forEach(section => section.style.display = 'none');
            document.getElementById('customer-panel').style.display = 'block';
            yourBankDetails.style.display = 'none';
        }

        // Form submission handlers

        fundBankForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const bankAddress = fundBankAddressInput.value;
            const amount = parseFloat(fundBankAmountInput.value);

            if (!ethers.utils.isAddress(bankAddress)) {
                alert('Invalid bank address');
                return;
            }

            if (isNaN(amount) || amount <= 0) {
                alert('Invalid amount');
                return;
            }

            try {
                const amountInWei = ethers.utils.parseEther(amount.toString());
                const tx = await contract.fundBank(bankAddress, amountInWei);
                await tx.wait();
                alert('Bank funded successfully');
            } catch (error) {
                console.error('Error funding bank:', error);
                alert('Failed to fund bank');
            }
        });

        transferBankForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const receiverAddress = transferReceiverAddressInput.value;
            const amount = parseFloat(transferAmountInput.value);

            if (!ethers.utils.isAddress(receiverAddress)) {
                alert('Invalid receiver address');
                return;
            }

            if (isNaN(amount) || amount <= 0) {
                alert('Invalid amount');
                return;
            }

            try {
                const amountInWei = ethers.utils.parseEther(amount.toString());
                const tx = await contract.transfer(receiverAddress, amountInWei);
                await tx.wait();
                alert('Funds transferred successfully');
            } catch (error) {
                console.error('Error transferring funds:', error);
                alert('Failed to transfer funds');
            }
        });

        customerKycForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = customerNameInput.value;
            const documentHash = documentHashInput.value;

            if (name.trim() === '') {
                alert('Name is required');
                return;
            }

            if (documentHash.trim() === '') {
                alert('Document hash is required');
                return;
            }

            try {
                // Convert the document hash string to bytes32 by hashing it
                const documentHashBytes32 = ethers.utils.keccak256(ethers.utils.toUtf8Bytes(documentHash));

                const tx = await contract.submitKYC(name, documentHashBytes32);
                await tx.wait();
                alert('KYC submitted successfully');
            } catch (error) {
                console.error('Error submitting KYC:', error);
                alert('Failed to submit KYC');
            }
        });

        addBankForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const bankName = bankNameInput.value;
            const bankAddress = bankAddressInput.value;
            const bankRegno = parseInt(bankRegnoInput.value);

            if (bankName.trim() === '') {
                alert('Bank name is required');
                return;
            }

            if (!ethers.utils.isAddress(bankAddress)) {
                alert('Invalid bank address');
                return;
            }

            if (isNaN(bankRegno) || bankRegno <= 0) {
                alert('Invalid registration number');
                return;
            }

            try {
                const tx = await contract.addBank(bankName, bankAddress, bankRegno);
                await tx.wait();
                alert('Bank added successfully');
            } catch (error) {
                console.error('Error adding bank:', error);
                alert('Failed to add bank');
            }
        });
    </script>
</body>

</html>
