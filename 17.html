<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Decentralized KYC DApp with Fund & Transfer</title>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    crossorigin="anonymous"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap"
    rel="stylesheet"
  />
  <style>
    /* Base styles */
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(to right, #6a82fb, #fc5c7d);
      color: #fff;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      padding: 1rem;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    header h1 {
      margin: 0;
      font-weight: 700;
      font-size: 1.5rem;
    }
    #authButtons button {
      background-color: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      margin-left: 10px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s ease;
    }
    #authButtons button:hover {
      background-color: rgba(255, 255, 255, 0.4);
    }

    /* Main container */
    #container {
      flex: 1;
      display: flex;
      height: calc(100% - 72px);
      overflow: hidden;
      display: none; /* Hidden until login */
    }

    /* Sidebar */
    #sidebar {
      width: 280px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(8px);
      border-right: 1px solid rgba(255, 255, 255, 0.3);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 2rem;
      overflow-y: auto;
    }
    #sidebar h2 {
      margin-top: 0;
      font-weight: 700;
      font-size: 1.25rem;
      border-bottom: 1px solid rgba(255,255,255,0.3);
      padding-bottom: 0.5rem;
    }
    #sidebar label {
      display: block;
      margin-bottom: 0.25rem;
      font-weight: 600;
    }
    #sidebar input {
      width: 100%;
      padding: 0.5rem;
      border-radius: 5px;
      border: none;
      font-size: 1rem;
      margin-bottom: 1rem;
      color: #333;
    }
    #sidebar button {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 0.75rem;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 100%;
    }
    #sidebar button:hover {
      background-color: #1e40af;
    }

    /* Main content */
    #mainContent {
      flex: 1;
      padding: 1rem 2rem;
      overflow-y: auto;
    }

    /* Tabs */
    #tabs {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }
    .tab-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .tab-btn:hover {
      background: rgba(255, 255, 255, 0.4);
    }
    .tab-btn.active {
      background: #2563eb;
      box-shadow: 0 0 8px #2563eb;
    }

    /* Panels */
    .panel {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 1rem;
      color: white;
      display: none;
    }
    .panel.active {
      display: block;
    }

    /* Bank list */
    #bankList,
    #adminBankList,
    #eventList {
      list-style-type: none;
      padding: 0;
      max-height: 250px;
      overflow-y: auto;
      margin-top: 0.5rem;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.1);
    }
    #bankList li,
    #adminBankList li,
    #eventList li {
      padding: 0.5rem 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.95rem;
    }

    /* Logs */
    #logOutput {
      background: rgba(255, 255, 255, 0.1);
      padding: 1rem;
      border-radius: 8px;
      font-family: monospace;
      font-size: 0.9rem;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      color: white;
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.4);
      margin-top: 1rem;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #4caf50;
      color: white;
      padding: 15px 20px;
      border-radius: 5px;
      z-index: 1000;
      opacity: 0;
      animation: fadeOut 3s forwards;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    }
    .notification.error {
      background-color: #f44336;
    }
    @keyframes fadeOut {
      0% {
        opacity: 1;
        transform: translateY(-20px);
      }
      90% {
        opacity: 1;
        transform: translateY(-20px);
      }
      100% {
        opacity: 0;
        transform: translateY(0);
      }
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(3px);
    }
    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      color: #333;
      font-weight: 500;
    }
    .modal-content h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      color: #2563eb;
      text-align: center;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      margin-top: -10px;
      margin-bottom: 10px;
    }
    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
    }
    .modal-content input {
      width: 100%;
      padding: 10px;
      margin-bottom: 1rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: none;
      color: #333;
    }
    .modal-content button {
      width: 100%;
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 12px;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      transition: background-color 0.3s ease;
    }
    .modal-content button:hover {
      background-color: #1e40af;
    }
  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-shield-alt"></i> Decentralized KYC</h1>
    <div>
      <p id="metaStatus">Not connected</p>
      <p id="adminStatus"></p>
    </div>
    <div id="authButtons">
      <button id="loginBtn">Login</button>
      <button id="signupBtn">Sign Up</button>
    </div>
  </header>

  <div id="container">
    <aside id="sidebar">
      <section id="fundBankSection">
        <h2>Fund Bank</h2>
        <label for="fundBankAddress">Bank Address (Admin)</label>
        <input type="text" id="fundBankAddress" placeholder="0x..." />
        <label for="fundAmount">Amount</label>
        <input type="number" id="fundAmount" placeholder="Amount" min="0" />
        <button id="fundBankBtn">Fund Bank</button>
      </section>

      <section id="transferBankSection">
        <h2>Transfer Bank</h2>
        <label for="transferSenderAddress">Sender Address (Your Wallet)</label>
        <input type="text" id="transferSenderAddress" disabled />
        <label for="transferReceiverAddress">Receiver Address</label>
        <input type="text" id="transferReceiverAddress" placeholder="0x..." />
        <label for="transferAmount">Amount</label>
        <input type="number" id="transferAmount" placeholder="Amount" min="0" />
        <button id="transferBankBtn">Transfer Funds</button>
      </section>
    </aside>

    <main id="mainContent">
      <div id="tabs">
        <button id="bankTabBtn" class="tab-btn active">Bank Panel</button>
        <button id="adminTabBtn" class="tab-btn" style="display:none;">Admin Panel</button>
        <button id="connectWalletBtn" class="tab-btn">Connect Wallet</button>
        <button id="adminAccessBtn" class="tab-btn">Admin Access</button>
      </div>

      <section id="bankPanel" class="panel active">
        <label for="bankName">Bank Name:</label>
        <input type="text" id="bankName" placeholder="e.g., Canara" />
        <label for="bankAddress">Bank Address:</label>
        <input type="text" id="bankAddress" placeholder="0x..." />
        <label for="bankRegNo">Registration No:</label>
        <input type="number" id="bankRegNo" placeholder="e.g., 1234" />
        <button id="addBank">Add Bank</button>
        <button id="removeBank">Remove Bank</button>

        <h3>Registered Banks</h3>
        <ul id="bankList"></ul>
      </section>

      <section id="adminPanel" class="panel">
        <h2>Admin Panel - Registered Banks</h2>
        <ul id="adminBankList"></ul>

        <h2>Transfer & Fund Events</h2>
        <ul id="eventList"></ul>
      </section>

      <h2>Activity Logs</h2>
      <div id="logOutput">Logs will appear here...</div>
    </main>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close" id="loginClose">&times;</span>
      <h2>Login</h2>
      <input type="email" id="loginEmail" placeholder="Email" />
      <input type="password" id="loginPassword" placeholder="Password" />
      <button id="loginSubmit">Login</button>
    </div>
  </div>

  <!-- Signup Modal -->
  <div id="signupModal" class="modal">
    <div class="modal-content">
      <span class="close" id="signupClose">&times;</span>
      <h2>Sign Up</h2>
      <input type="email" id="signupEmail" placeholder="Email" />
      <input type="password" id="signupPassword" placeholder="Password" />
      <label for="signupDob">Date of Birth</label>
      <input type="date" id="signupDob" />
      <label for="signupAadhaar">Aadhaar Number</label>
      <input type="text" id="signupAadhaar" placeholder="XXXX-XXXX-XXXX" maxlength="14" />
      <button id="signupSubmit">Sign Up</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.7.5/dist/web3.min.js"></script>
  <script>
    let web3, contract, account, adminAddress;
    const contractAddress = "0x13581C23676edB47E5d3b2cfdd949Bb70b859F7D"; // Replace with your contract address
    const contractABI = [
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "_bankAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_registerNumber",
				"type": "uint256"
			}
		],
		"name": "addBank",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "bankAddress",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			}
		],
		"name": "BankAdded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "bankAddress",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "BankFunded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "bankAddress",
				"type": "address"
			}
		],
		"name": "BankRemoved",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "bankAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "fundBank",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "login",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "count",
				"type": "uint256"
			}
		],
		"name": "Login",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_bankAddress",
				"type": "address"
			}
		],
		"name": "removeBank",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "transfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "bankAddresses",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_bank",
				"type": "address"
			}
		],
		"name": "getBankDetails",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "kycProviders",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "kycRecords",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "documentHash",
				"type": "string"
			},
			{
				"internalType": "enum DecentralizedKYC.Status",
				"name": "status",
				"type": "uint8"
			},
			{
				"internalType": "address",
				"name": "verifiedBy",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "registeredBanks",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "addr",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "registerNumber",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "balance",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "loginCount",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "exists",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

    // Elements
    const authButtonsDiv = document.getElementById("authButtons");
    const containerDiv = document.getElementById("container");
    const fundBankBtn = document.getElementById("fundBankBtn");
    const transferBankBtn = document.getElementById("transferBankBtn");
    const connectWalletBtn = document.getElementById("connectWalletBtn");
    const adminAccessBtn = document.getElementById("adminAccessBtn");
    const bankTabBtn = document.getElementById("bankTabBtn");
    const adminTabBtn = document.getElementById("adminTabBtn");
    const bankPanel = document.getElementById("bankPanel");
    const adminPanel = document.getElementById("adminPanel");
    const transferSenderAddressInput = document.getElementById("transferSenderAddress");
    const logOutput = document.getElementById("logOutput");

    // Login/signup modal elements
    const loginModal = document.getElementById("loginModal");
    const signupModal = document.getElementById("signupModal");
    const loginBtn = document.getElementById("loginBtn");
    const signupBtn = document.getElementById("signupBtn");
    const loginClose = document.getElementById("loginClose");
    const signupClose = document.getElementById("signupClose");

    // User DB (in-memory demo)
    const usersDB = {};
    let loggedInUser = null;

    // Utility functions
    function log(message) {
      const time = new Date().toLocaleTimeString();
      logOutput.textContent += `[${time}] ${message}\n`;
      logOutput.scrollTop = logOutput.scrollHeight;
    }

    function showNotification(message, type = "success") {
      const notification = document.createElement("div");
      notification.classList.add("notification", type);
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
    }

    // Setup modal open/close
    loginBtn.onclick = () => loginModal.style.display = "block";
    signupBtn.onclick = () => signupModal.style.display = "block";
    loginClose.onclick = () => loginModal.style.display = "none";
    signupClose.onclick = () => signupModal.style.display = "none";
    window.onclick = e => {
      if (e.target === loginModal) loginModal.style.display = "none";
      if (e.target === signupModal) signupModal.style.display = "none";
    };

    // Login/signup handlers
    document.getElementById("signupSubmit").onclick = () => {
      const email = document.getElementById("signupEmail").value.trim().toLowerCase();
      const password = document.getElementById("signupPassword").value;
      const dob = document.getElementById("signupDob").value;
      const aadhaar = document.getElementById("signupAadhaar").value.trim();
      if (!email || !password || !dob || !aadhaar) return alert("Fill all fields");
      if (usersDB[email]) return alert("User exists, please login");
      usersDB[email] = { password, dob, aadhaar };
      alert("Signup successful! Please login.");
      signupModal.style.display = "none";
    };

    document.getElementById("loginSubmit").onclick = () => {
      const email = document.getElementById("loginEmail").value.trim().toLowerCase();
      const password = document.getElementById("loginPassword").value;
      if (!email || !password) return alert("Enter email and password");
      if (!usersDB[email]) return alert("User not found, please signup");
      if (usersDB[email].password !== password) return alert("Incorrect password");
      loggedInUser = email;
      alert(`Welcome back, ${email}!`);
      loginModal.style.display = "none";
      authButtonsDiv.style.display = "none";
      containerDiv.style.display = "flex";
      if (account) transferSenderAddressInput.value = account;
    };

    // Tab switching
    bankTabBtn.onclick = () => {
      bankTabBtn.classList.add("active");
      adminTabBtn.classList.remove("active");
      bankPanel.classList.add("active");
      adminPanel.classList.remove("active");
    };
    adminTabBtn.onclick = () => {
      bankTabBtn.classList.remove("active");
      adminTabBtn.classList.add("active");
      bankPanel.classList.remove("active");
      adminPanel.classList.add("active");
    };

    // Connect wallet
    connectWalletBtn.onclick = async () => {
      if (!window.ethereum) {
        showNotification("Please install MetaMask", "error");
        return;
      }
      try {
        await window.ethereum.request({ method: "eth_requestAccounts" });
        web3 = new Web3(window.ethereum);
        const accounts = await web3.eth.getAccounts();
        account = accounts[0];
        transferSenderAddressInput.value = account;
        document.getElementById("metaStatus").textContent = `Connected: ${account}`;
        contract = new web3.eth.Contract(contractABI, contractAddress);
        adminAddress = await contract.methods.admin().call();
        if (adminAddress.toLowerCase() === account.toLowerCase()) {
          document.getElementById("adminStatus").textContent = "You are the admin";
          adminTabBtn.style.display = "inline-block";
        } else {
          document.getElementById("adminStatus").textContent = "You are NOT the admin";
          adminTabBtn.style.display = "none";
        }
        await loadBankList();
      } catch (err) {
        showNotification(`Error: ${err.message}`, "error");
      }
    };

    // Admin access
    adminAccessBtn.onclick = async () => {
      if (!contract) return showNotification("Connect wallet first!", "error");
      const key = prompt("Enter admin secret key (admin address):");
      if (!key) return;
      try {
        const realAdmin = await contract.methods.admin().call();
        if (key.toLowerCase() === realAdmin.toLowerCase()) {
          showNotification("Admin access granted!");
          adminTabBtn.style.display = "inline-block";
          adminTabBtn.click();
          await loadAdminBankList();
          await loadEvents();
        } else {
          showNotification("Invalid admin key!", "error");
        }
      } catch (err) {
        showNotification(`Error: ${err.message}`, "error");
      }
    };

    // Add bank
    document.getElementById("addBank").onclick = async () => {
      const name = document.getElementById("bankName").value.trim();
      const addr = document.getElementById("bankAddress").value.trim();
      const reg = document.getElementById("bankRegNo").value.trim();
      if (!name || !addr || !reg) return showNotification("Fill all bank fields", "error");
      try {
        await contract.methods.addBank(name, addr, reg).send({ from: account, gas: 300000 });
        showNotification("Bank added successfully!");
        await loadBankList();
      } catch (err) {
        showNotification(`Error: ${err.message}`, "error");
      }
    };

    // Remove bank
    document.getElementById("removeBank").onclick = async () => {
      const addr = document.getElementById("bankAddress").value.trim();
      if (!addr) return showNotification("Enter bank address to remove", "error");
      try {
        await contract.methods.removeBank(addr).send({ from: account });
        showNotification("Bank removed successfully!");
        await loadBankList();
      } catch (err) {
        showNotification(`Error: ${err.message}`, "error");
      }
    };

    // Fund bank
    fundBankBtn.onclick = async () => {
      const addr = document.getElementById("fundBankAddress").value.trim();
      const amount = document.getElementById("fundAmount").value.trim();
      if (!addr || !amount) return showNotification("Enter bank address and amount", "error");
      try {
        await contract.methods.fundBank(addr, amount).send({ from: account });
        showNotification("Bank funded successfully!");
      } catch (err) {
        showNotification(`Error: ${err.message}`, "error");
      }
    };

    // Transfer funds
    transferBankBtn.onclick = async () => {
      const receiver = document.getElementById("transferReceiverAddress").value.trim();
      const amount = document.getElementById("transferAmount").value.trim();
      if (!receiver || !amount) return showNotification("Enter receiver address and amount", "error");
      try {
        await contract.methods.transfer(receiver, amount).send({ from: account });
        showNotification("Funds transferred successfully!");
      } catch (err) {
        showNotification(`Error: ${err.message}`, "error");
      }
    };

    // Load bank list for Bank Panel
    async function loadBankList() {
      const bankListEl = document.getElementById("bankList");
      bankListEl.innerHTML = "";
      try {
        for (let i = 0; ; i++) {
          try {
            const addr = await contract.methods.bankAddresses(i).call();
            const details = await contract.methods.getBankDetails(addr).call();
            const li = document.createElement("li");
            li.textContent = `${details[0]} (Reg#: ${details[2]}, Addr: ${addr})`;
            bankListEl.appendChild(li);
          } catch { break; }
        }
      } catch (err) {
        showNotification(`Error loading banks: ${err.message}`, "error");
      }
    }

    // Load bank list and events for Admin Panel
    async function loadAdminBankList() {
      const adminBankListEl = document.getElementById("adminBankList");
      adminBankListEl.innerHTML = "";
      try {
        for (let i = 0; ; i++) {
          try {
            const addr = await contract.methods.bankAddresses(i).call();
            const details = await contract.methods.getBankDetails(addr).call();
            const li = document.createElement("li");
            li.innerHTML = `<b>Name:</b> ${details[0]}<br>
                            <b>Address:</b> ${addr}<br>
                            <b>Reg No:</b> ${details[2]}<br>
                            <b>Balance:</b> ${details[3]}<br>
                            <b>Login Count:</b> ${details[4]}<br><hr>`;
            adminBankListEl.appendChild(li);
          } catch { break; }
        }
      } catch (err) {
        showNotification(`Error loading admin banks: ${err.message}`, "error");
      }
    }

    // Load Transfer and Fund events for Admin Panel
    async function loadEvents() {
      const eventListEl = document.getElementById("eventList");
      eventListEl.innerHTML = "";
      try {
        const transfers = await contract.getPastEvents("Transfer", { fromBlock: 0, toBlock: "latest" });
        const fundings = await contract.getPastEvents("BankFunded", { fromBlock: 0, toBlock: "latest" });

        if (transfers.length === 0 && fundings.length === 0) {
          eventListEl.innerHTML = "<li>No transfer or fund events found.</li>";
          return;
        }

        transfers.forEach(ev => {
          const li = document.createElement("li");
          li.innerHTML = `<b>Transfer</b><br>
                          Sender: ${ev.returnValues.sender}<br>
                          Receiver: ${ev.returnValues.receiver}<br>
                          Amount: ${ev.returnValues.amount}`;
          eventListEl.appendChild(li);
        });

        fundings.forEach(ev => {
          const li = document.createElement("li");
          li.innerHTML = `<b>Funded</b><br>
                          Bank: ${ev.returnValues.bankAddress}<br>
                          Amount: ${ev.returnValues.amount}`;
          eventListEl.appendChild(li);
        });
      } catch (err) {
        showNotification(`Error loading events: ${err.message}`, "error");
      }
    }

  </script>
</body>
</html>
